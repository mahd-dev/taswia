module.exports = function (opt) {
  def_opt = {};
  if(!opt.server){
    def_opt.server = require('http').createServer();
  }
  var io = require('socket.io')(opt.server || def_opt.server);
  if(opt.session){
    var sharedsession = require("express-socket.io-session");
    io.use(sharedsession(opt.session, {
      autosave: true
    }));
  }

  io.on("connection", function(socket) {

    socket.on("login", function(userdata) {
      console.log(socket.handshake.session.userdata);
      socket.handshake.session.userdata = userdata;
    });
    socket.on("logout", function(userdata) {
      if (socket.handshake.session.userdata) {
        delete socket.handshake.session.userdata;
      }
    });

    socket.on('patch', function (patch) {
      console.log(patch);
    });

    socket.on("disconnect", function() {
    });

  });

  if(def_opt.server) def_opt.server.listen(opt.port || process.env.PORT || 80);

  return {

  }
}
